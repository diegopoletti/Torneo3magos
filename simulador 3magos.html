<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador ESP32 Trivia de Magos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .simulator {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .esp32 {
            width: 400px;
            height: 600px;
            background-color: #3498db;
            position: relative;
            border-radius: 20px;
        }
        .button-container {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .button {
            width: 40px;
            height: 40px;
            background-color: #e74c3c;
            border-radius: 50%;
            cursor: pointer;
            margin-bottom: 5px;
        }
        .button-label {
            font-size: 12px;
            color: white;
            text-align: center;
        }
        #button-container-1 { top: 50px; left: 50px; }
        #button-container-2 { top: 50px; right: 50px; }
        #button-container-3 { bottom: 50px; left: 50px; }
        #button-container-4 { bottom: 50px; right: 50px; }
        .led-container {
            position: absolute;
            top: 280px;
            left: 170px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .led {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-bottom: 5px;
        }
        .led-label {
            font-size: 12px;
            color: white;
            text-align: center;
        }
        .motor {
            width: 80px;
            height: 80px;
            background-color: #95a5a6;
            border-radius: 50%;
            position: absolute;
            bottom: 100px;
            left: 160px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        .controls {
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="simulator">
        <h2>Simulador ESP32 Trivia de Magos</h2>
        <div class="esp32">
            <div class="button-container" id="button-container-1">
                <div class="button" id="button1"></div>
                <div class="button-label">Botón 1</div>
            </div>
            <div class="button-container" id="button-container-2">
                <div class="button" id="button2"></div>
                <div class="button-label">Botón 2</div>
            </div>
            <div class="button-container" id="button-container-3">
                <div class="button" id="button3"></div>
                <div class="button-label">Botón 3</div>
            </div>
            <div class="button-container" id="button-container-4">
                <div class="button" id="button4"></div>
                <div class="button-label">Botón 4</div>
            </div>
            <div class="led-container">
                <div class="led" id="led"></div>
                <div class="led-label">LED RGB</div>
            </div>
            <div class="motor" id="motor">Motor</div>
        </div>
        <div class="controls">
            <input type="file" id="codeInput" accept=".ino">
            <button onclick="loadCode()">Cargar Código</button>
            <button onclick="startSimulation()">Iniciar Simulación</button>
        </div>
    </div>
    <div class="simulator">
        <h2>Código Arduino</h2>
        <textarea id="codeArea" readonly></textarea>
        <div id="console"></div>
    </div>

    <script>
        let code = '';
        let gameState = {
            currentState: 'INICIO',
            categorySelected: -1,
            currentQuestion: 0,
            correctAnswers: 0
        };

        function loadCode() {
            const fileInput = document.getElementById('codeInput');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    code = e.target.result;
                    document.getElementById('codeArea').value = code;
                };
                reader.readAsText(file);
            }
        }

        function startSimulation() {
            if (!code) {
                alert('Por favor, carga un archivo de código primero.');
                return;
            }
            simulateSetup();
            simulateLoop();
        }

        function simulateSetup() {
            console.log('Iniciando simulación...');
            document.getElementById('console').innerHTML += 'Iniciando simulación...<br>';
        }

        function simulateLoop() {
            switch (gameState.currentState) {
                case 'INICIO':
                    simulateAudio('/intro.mp3');
                    gameState.currentState = 'SELECCION_CATEGORIA';
                    break;
                case 'SELECCION_CATEGORIA':
                    if (gameState.categorySelected === -1) {
                        document.getElementById('console').innerHTML += 'Esperando selección de categoría...<br>';
                    } else {
                        gameState.currentState = 'REPRODUCCION_PREGUNTA';
                    }
                    break;
                case 'REPRODUCCION_PREGUNTA':
                    simulateAudio(`/categoria${gameState.categorySelected + 1}/pregunta${gameState.currentQuestion + 1}.mp3`);
                    gameState.currentState = 'ESPERA_RESPUESTA';
                    break;
                case 'ESPERA_RESPUESTA':
                    document.getElementById('console').innerHTML += 'Esperando respuesta...<br>';
                    break;
                case 'VERIFICACION_RESPUESTA':
                    if (Math.random() > 0.5) {
                        gameState.correctAnswers++;
                        simulateAudio('/correcta.mp3');
                        setLedColor('#00ff00');
                    } else {
                        simulateAudio('/incorrecta.mp3');
                        setLedColor('#ff0000');
                    }
                    gameState.currentQuestion++;
                    if (gameState.currentQuestion < 5) {
                        gameState.currentState = 'REPRODUCCION_PREGUNTA';
                    } else {
                        gameState.currentState = 'FIN_JUEGO';
                    }
                    break;
                case 'FIN_JUEGO':
                    if (gameState.correctAnswers === 5) {
                        simulateAudio('/campeon.mp3');
                        setLedColor('#ffffff');
                    } else if (gameState.correctAnswers > 3) {
                        simulateAudio('/ganador.mp3');
                        setLedColor('#ffa500');
                    } else {
                        simulateAudio('/perdedor.mp3');
                        setLedColor('#0000ff');
                    }
                    gameState.currentState = 'INICIO';
                    gameState.categorySelected = -1;
                    gameState.currentQuestion = 0;
                    gameState.correctAnswers = 0;
                    break;
            }
            setTimeout(simulateLoop, 2000);
        }

        function simulateAudio(file) {
            document.getElementById('console').innerHTML += `Reproduciendo audio: ${file}<br>`;
        }

        function setLedColor(color) {
            document.getElementById('led').style.backgroundColor = color;
        }

        document.querySelectorAll('.button').forEach((button, index) => {
            button.addEventListener('click', () => {
                if (gameState.currentState === 'SELECCION_CATEGORIA' && gameState.categorySelected === -1) {
                    gameState.categorySelected = index;
                    document.getElementById('console').innerHTML += `Categoría seleccionada: ${index + 1}<br>`;
                } else if (gameState.currentState === 'ESPERA_RESPUESTA') {
                    gameState.currentState = 'VERIFICACION_RESPUESTA';
                }
            });
        });

        function simulateMotor() {
            const motor = document.getElementById('motor');
            let rotation = 0;
            setInterval(() => {
                rotation += 10;
                motor.style.transform = `rotate(${rotation}deg)`;
            }, 50);
        }

        simulateMotor();
    </script>
</body>
</html>